@model CursoDetalhesViewMOD
@{
    ViewData["Title"] = "Criar Novo Curso";
}

<div class="container-fluid mt-4 mb-5">
    <div class="row mb-4">
        <div class="col-8 text-start">
            <h2 class="mb-0 text-gray-dark-unimed">
                <i class="fas fa-plus-circle text-orange-unimed me-2"></i>
                Criar Novo Curso
            </h2>
        </div>
        <div class="col-4 text-end">
            <a class="btn btn-outline-gray" asp-action="Index" asp-controller="Cursos" asp-area="Afiliado">
                <span class="fas fa-chevron-left me-2"></span>Voltar
            </a>
        </div>
    </div>

    <div class="card shadow-sm mb-4">
        <div class="card-header text-gray-dark-unimed bg-gray-light-unimed">
            <h5 class="mb-0">Informações Principais</h5>
        </div>
        <div class="card-body">
            @using (Html.BeginForm("Criar", "Cursos", new { area = "Afiliado" }, FormMethod.Post, true, new { enctype = "multipart/form-data" }))
            {
                @Html.AntiForgeryToken()
                @Html.HiddenFor(m => m.Curso.CdCurso)
                @Html.HiddenFor(m => m.Curso.SnAtivo)
                @Html.HiddenFor(m => m.Curso.CdAfiliado)
                @Html.HiddenFor(m => m.Curso.TxCaminhoImagem)

                <div class="row g-3">
                    <div class="col-md-8">
                        @Html.LabelFor(m => m.Curso.NoCurso, new { @class = "form-label text-gray-medium" })
                        @Html.TextBoxFor(m => m.Curso.NoCurso, new { @class = "form-control", placeholder = "Informe o nome do curso", maxlength = "100" })
                        @Html.ValidationMessageFor(m => m.Curso.NoCurso, "", new { @class = "text-danger" })
                    </div>
                    <div class="col-md-4">
                        @Html.LabelFor(m => m.Curso.DcValor, new { @class = "form-label text-gray-medium" })
                        @Html.TextBoxFor(m => m.Curso.DcValor, new { @class = "form-control", placeholder = "Informe o valor do curso.", maxlength = "10" })
                        @Html.ValidationMessageFor(m => m.Curso.DcValor, "", new { @class = "text-danger" })
                    </div>
                    <div class="col-md-12">
                        @Html.LabelFor(m => m.Curso.TxDescricao, new { @class = "form-label text-gray-medium" })
                        @Html.TextAreaFor(m => m.Curso.TxDescricao, new { @class = "form-control", placeholder = "Informe a descrição do curso", maxlength = "500" })
                        @Html.ValidationMessageFor(m => m.Curso.TxDescricao, "", new { @class = "text-danger" })
                    </div>
                    <div class="col-md-8 mt-3">
                        <label class="form-label text-gray-medium">Preview da Imagem</label>
                        <div class="border p-2 rounded text-center">
                            <img id="imagemPreview"
                                 src="/images/default_course.png"
                                 alt="Preview da Imagem do Curso" class="img-fluid rounded" style="max-height: 100px; object-fit: cover;">
                            <button type="button" class="btn btn-sm btn-outline-danger mt-2 d-none" id="btnRemoverImagem">
                                <i class="fas fa-times-circle me-1"></i> Remover Imagem
                            </button>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label text-gray-medium">Imagem de Capa</label>
                        <div class="input-group">
                            <input type="file" class="form-control" id="imagemUpload" name="ImagemUpload" accept="image/*">
                            <label class="input-group-text text-gray-medium" for="imagemUpload"><i class="fas fa-upload me-2"></i>Upload</label>
                        </div>
                        <small class="form-text text-muted">Formatos: JPG, PNG. Tamanho máximo: 2MB. Recomendado: 1200x675px.</small>
                        @Html.ValidationMessageFor(m => m.ImagemUpload, "", new { @class = "text-danger" })
                    </div>
                </div>
                <div class="row mt-4">
                    <div class="col-12 text-end">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-1"></i> Criar Curso
                        </button>
                    </div>
                </div>
            }
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script>
        $(document).ready(function () {
            // Preview da imagem ao selecionar
            $('#imagemUpload').on('change', function (e) {
                var file = e.target.files[0];
                if (file) {
                    var reader = new FileReader();
                    reader.onload = function (e) {
                        $('#imagemPreview').attr('src', e.target.result);
                        // Na tela de criar, o botão de remover imagem é gerenciado apenas pelo input file
                        // Não tem um caminho de imagem pré-existente no DB
                        $('#btnRemoverImagem').addClass('d-none'); // Esconde sempre
                    };
                    reader.readAsDataURL(file);
                } else {
                    // Se nenhum arquivo for selecionado, volta para a imagem padrão
                    $('#imagemPreview').attr('src', '/images/default_course.png');
                    $('#btnRemoverImagem').addClass('d-none'); // Esconde sempre
                }
            });

            // Na tela de criação, o botão "Remover Imagem" não tem função AJAX direta,
            // ele apenas limpa o preview e o input de arquivo.
            $('#btnRemoverImagem').on('click', function (e) {
                e.preventDefault();
                $('#imagemPreview').attr('src', '/images/default_course.png');
                $('#imagemUpload').val(''); // Limpa o input file
                $('#btnRemoverImagem').addClass('d-none');
            });
        });
    </script>
}